{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/jonnohuang/cat-ai-factory/repo/shared/segment_stitch_report.v1.schema.json",
  "title": "Segment Stitch Report v1",
  "description": "Deterministic runtime report for segment generate+stitch execution.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "version",
    "job_id",
    "plan_relpath",
    "segments_dir",
    "stitched_preview",
    "segments",
    "seams"
  ],
  "properties": {
    "version": {"const": "segment_stitch_report.v1"},
    "job_id": {"type": "string", "minLength": 1},
    "plan_relpath": {"type": "string", "pattern": "^repo/(canon|examples)/[a-zA-Z0-9._/-]+\\.json$"},
    "segments_dir": {"type": "string", "pattern": "^sandbox/output/.+/segments$"},
    "stitched_preview": {"type": "string", "pattern": "^sandbox/output/.+/segments/stitched_preview\\.mp4$"},
    "segments": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["segment_id", "start_sec", "end_sec", "output_relpath", "duration_sec"],
        "properties": {
          "segment_id": {"type": "string", "pattern": "^seg_[0-9]{3}$"},
          "start_sec": {"type": "number", "minimum": 0},
          "end_sec": {"type": "number", "minimum": 0},
          "output_relpath": {"type": "string", "pattern": "^sandbox/output/.+/segments/seg_[0-9]{3}\\.mp4$"},
          "duration_sec": {"type": "number", "minimum": 0}
        }
      }
    },
    "skipped_segments": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["segment_id", "reason", "start_sec", "end_sec"],
        "properties": {
          "segment_id": {"type": "string", "pattern": "^seg_[0-9]{3}$"},
          "reason": {
            "type": "string",
            "enum": [
              "out_of_source_range",
              "too_short_after_clamp",
              "empty_output"
            ]
          },
          "start_sec": {"type": "number", "minimum": 0},
          "end_sec": {"type": "number", "minimum": 0}
        }
      }
    },
    "seams": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["from_segment", "to_segment", "method", "blend_frames", "transition"],
        "properties": {
          "from_segment": {"type": "string", "pattern": "^seg_[0-9]{3}$"},
          "to_segment": {"type": "string", "pattern": "^seg_[0-9]{3}$"},
          "method": {"type": "string", "enum": ["hard_cut", "crossfade", "motion_blend"]},
          "blend_frames": {"type": "integer", "minimum": 0, "maximum": 60},
          "transition": {"type": "string", "enum": ["none", "fade", "smoothleft"]}
        }
      }
    },
    "retry_hook_applied": {
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "retry_type",
        "mode",
        "target_segments",
        "trigger_metrics",
        "retry_plan_relpath",
        "attempt_id"
      ],
      "properties": {
        "retry_type": {
          "type": "string",
          "enum": [
            "motion",
            "recast"
          ]
        },
        "mode": {
          "type": "string",
          "enum": [
            "none",
            "retry_all",
            "retry_selected"
          ]
        },
        "target_segments": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^seg_[0-9]{3}$"
          }
        },
        "trigger_metrics": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "retry_plan_relpath": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^(sandbox/.+\\.json)?$"
        },
        "attempt_id": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    }
  }
}
