{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CatShortJob",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "job_id",
    "date",
    "niche",
    "video",
    "script",
    "shots",
    "captions",
    "hashtags",
    "render"
  ],
  "properties": {
    "job_id": {
      "type": "string",
      "minLength": 6,
      "pattern": "^[a-z0-9-]+$"
    },
    "date": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "lane": {
      "type": "string",
      "enum": [
        "ai_video",
        "image_motion",
        "template_remix",
        "dance_swap"
      ]
    },
    "prompt": {
      "type": "string",
      "description": "Rich generative prompt including motion and style tokens for AI video/frame providers."
    },
    "niche": {
      "type": "string"
    },
    "video": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "length_seconds",
        "aspect_ratio",
        "fps",
        "resolution"
      ],
      "properties": {
        "length_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 60
        },
        "aspect_ratio": {
          "type": "string",
          "enum": [
            "9:16"
          ]
        },
        "fps": {
          "type": "integer",
          "minimum": 24,
          "maximum": 60
        },
        "resolution": {
          "type": "string",
          "enum": [
            "1080x1920"
          ]
        }
      }
    },
    "script": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "hook",
        "voiceover",
        "ending"
      ],
      "properties": {
        "hook": {
          "type": "string",
          "minLength": 3,
          "maxLength": 120
        },
        "voiceover": {
          "type": "string",
          "minLength": 20,
          "maxLength": 900
        },
        "ending": {
          "type": "string",
          "minLength": 3,
          "maxLength": 120
        }
      }
    },
    "shots": {
      "type": "array",
      "minItems": 6,
      "maxItems": 14,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "t",
          "visual",
          "action",
          "caption"
        ],
        "properties": {
          "t": {
            "type": "integer",
            "minimum": 0,
            "maximum": 60
          },
          "visual": {
            "type": "string"
          },
          "action": {
            "type": "string"
          },
          "caption": {
            "type": "string"
          }
        }
      }
    },
    "captions": {
      "type": "array",
      "minItems": 4,
      "maxItems": 24,
      "items": {
        "type": "string",
        "minLength": 1,
        "maxLength": 80
      }
    },
    "hashtags": {
      "type": "array",
      "minItems": 3,
      "maxItems": 20,
      "items": {
        "type": "string",
        "pattern": "^#\\w[\\w_]*$"
      }
    },
    "render": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "background_asset",
        "subtitle_style",
        "output_basename"
      ],
      "properties": {
        "background_asset": {
          "type": "string",
          "pattern": "^(assets|sandbox/assets)/.+"
        },
        "subtitle_style": {
          "type": "string",
          "enum": [
            "big_bottom",
            "karaoke_bottom"
          ]
        },
        "output_basename": {
          "type": "string"
        }
      }
    },
    "audio": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "audio_asset"
      ],
      "properties": {
        "audio_asset": {
          "type": "string"
        }
      }
    },
    "template": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "template_id"
      ],
      "properties": {
        "template_id": {
          "type": "string"
        },
        "params": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "duration_seconds": {
              "type": "integer",
              "minimum": 1,
              "maximum": 60
            },
            "clip_start_seconds": {
              "type": "number",
              "minimum": 0
            },
            "clip_end_seconds": {
              "type": "number",
              "minimum": 0
            },
            "foreground_asset": {
              "type": "string",
              "pattern": "^(assets|sandbox/assets)/.+"
            }
          }
        }
      }
    },
    "image_motion": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "seed_frames",
        "motion_preset"
      ],
      "properties": {
        "seed_frames": {
          "type": "array",
          "minItems": 1,
          "maxItems": 3,
          "items": {
            "type": "string"
          }
        },
        "motion_preset": {
          "type": "string",
          "enum": [
            "kb_zoom_in",
            "kb_zoom_out",
            "pan_lr",
            "pan_ud",
            "shake_soft",
            "cut_3frame"
          ]
        }
      }
    },
    "dance_swap": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "loop_artifact",
        "tracks_artifact",
        "foreground_asset"
      ],
      "properties": {
        "loop_artifact": {
          "type": "string",
          "pattern": "^(assets|output|sandbox/assets|sandbox/output)/.+\\.json$"
        },
        "tracks_artifact": {
          "type": "string",
          "pattern": "^(assets|output|sandbox/assets|sandbox/output)/.+\\.json$"
        },
        "beatflow_artifact": {
          "type": "string",
          "pattern": "^(assets|output|sandbox/assets|sandbox/output)/.+\\.json$"
        },
        "foreground_asset": {
          "type": "string",
          "pattern": "^(assets|sandbox/assets)/.+"
        },
        "subject_id": {
          "type": "string",
          "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
        }
      }
    },
    "segment_stitch": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "plan_relpath"
      ],
      "properties": {
        "plan_relpath": {
          "type": "string",
          "pattern": "^repo/(canon|examples)/[a-zA-Z0-9._/-]+\\.json$"
        },
        "enabled": {
          "type": "boolean"
        }
      }
    },
    "quality_target": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "relpath"
      ],
      "properties": {
        "relpath": {
          "type": "string",
          "pattern": "^repo/(canon|examples)/[a-zA-Z0-9._/-]+\\.json$"
        }
      }
    },
    "continuity_pack": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "relpath"
      ],
      "properties": {
        "relpath": {
          "type": "string",
          "pattern": "^repo/(canon|examples)/[a-zA-Z0-9._/-]+\\.json$"
        }
      }
    },
    "quality_policy": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "relpath"
      ],
      "properties": {
        "relpath": {
          "type": "string",
          "pattern": "^repo/(shared|canon|examples)/[a-zA-Z0-9._/-]+\\.json$"
        }
      }
    },
    "motion_contract": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "relpath"
      ],
      "properties": {
        "relpath": {
          "type": "string",
          "pattern": "^repo/(shared|canon|examples)/[a-zA-Z0-9._/-]+\\.json$"
        },
        "contract_version": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "captions_artifact": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "relpath"
      ],
      "properties": {
        "relpath": {
          "type": "string",
          "pattern": "^(repo/(canon|examples)/[a-zA-Z0-9._/-]+\\.json|sandbox/[a-zA-Z0-9._/-]+\\.json)$"
        }
      }
    },
    "generation_policy": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "registry_relpath",
        "video_provider_order",
        "frame_provider_order"
      ],
      "properties": {
        "registry_relpath": {
          "type": "string",
          "pattern": "^repo/(shared|canon|examples)/[a-zA-Z0-9._/-]+\\.json$"
        },
        "baseline_video_provider": {
          "type": "string",
          "minLength": 1
        },
        "baseline_frame_provider": {
          "type": "string",
          "minLength": 1
        },
        "route_mode": {
          "type": "string",
          "enum": [
            "production",
            "lab"
          ]
        },
        "selected_video_provider": {
          "type": "string",
          "minLength": 1
        },
        "selected_frame_provider": {
          "type": "string",
          "minLength": 1
        },
        "video_provider_order": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "frame_provider_order": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "lab_challenger_order": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "motion_constraints": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "post_process_order": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "pointer_resolution": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "version",
        "required",
        "selection_policy",
        "selected",
        "rejected",
        "fallback_used"
      ],
      "properties": {
        "version": {
          "type": "string",
          "const": "pointer_resolution.v1"
        },
        "analysis_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "required": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "motion_contract",
              "quality_target",
              "segment_stitch",
              "continuity_pack"
            ]
          }
        },
        "selection_policy": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "source_precedence",
            "tie_break"
          ],
          "properties": {
            "source_precedence": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "tie_break": {
              "type": "string",
              "minLength": 1
            }
          }
        },
        "selected": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "relpath",
              "source",
              "priority",
              "exists"
            ],
            "properties": {
              "relpath": {
                "type": "string",
                "minLength": 1
              },
              "source": {
                "type": "string",
                "minLength": 1
              },
              "priority": {
                "type": "integer"
              },
              "exists": {
                "type": "boolean"
              }
            }
          }
        },
        "rejected": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "pointer",
              "relpath",
              "source",
              "priority",
              "reason"
            ],
            "properties": {
              "pointer": {
                "type": "string",
                "enum": [
                  "motion_contract",
                  "quality_target",
                  "segment_stitch",
                  "continuity_pack"
                ]
              },
              "relpath": {
                "type": "string",
                "minLength": 1
              },
              "source": {
                "type": "string",
                "minLength": 1
              },
              "priority": {
                "type": "integer"
              },
              "reason": {
                "type": "string",
                "enum": [
                  "lower_priority_than_selected",
                  "path_not_found"
                ]
              }
            }
          }
        },
        "fallback_used": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "motion_contract",
              "quality_target",
              "segment_stitch",
              "continuity_pack"
            ]
          }
        }
      }
    },
    "comfyui": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "provider",
        "base_url",
        "workflow_id",
        "workflow_relpath",
        "bindings",
        "poll"
      ],
      "properties": {
        "provider": {
          "type": "string",
          "minLength": 1
        },
        "base_url": {
          "type": "string",
          "pattern": "^https?://.+"
        },
        "workflow_id": {
          "type": "string",
          "minLength": 1
        },
        "workflow_relpath": {
          "type": "string",
          "pattern": "^repo/workflows/comfy/[a-zA-Z0-9._-]+\\.json$"
        },
        "client_id": {
          "type": "string",
          "minLength": 1
        },
        "bindings": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "positive_prompt",
            "negative_prompt",
            "seed",
            "positive_nodes",
            "negative_nodes",
            "seed_nodes"
          ],
          "properties": {
            "positive_prompt": {
              "type": "string",
              "minLength": 1
            },
            "negative_prompt": {
              "type": "string",
              "minLength": 1
            },
            "seed": {
              "type": "integer",
              "minimum": 0
            },
            "positive_nodes": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "negative_nodes": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "seed_nodes": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "identity_image_path": {
              "type": "string"
            },
            "pose_video_path": {
              "type": "string"
            }
          }
        },
        "poll": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "timeout_seconds",
            "interval_seconds"
          ],
          "properties": {
            "timeout_seconds": {
              "type": "integer",
              "minimum": 1
            },
            "interval_seconds": {
              "type": "integer",
              "minimum": 1
            }
          }
        }
      }
    },
    "creativity": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "mode": {
          "type": "string",
          "enum": [
            "canon",
            "balanced",
            "experimental"
          ]
        },
        "canon_fidelity": {
          "type": "string",
          "enum": [
            "high",
            "medium"
          ]
        }
      }
    }
  }
}