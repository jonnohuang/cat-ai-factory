{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/jonnohuang/cat-ai-factory/repo/shared/segment_debug_manifest.v1.schema.json",
  "title": "Segment Debug Manifest v1",
  "description": "Deterministic segment/shot debug artifact manifest.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "version",
    "job_id",
    "source_final_mp4",
    "debug_dir",
    "inputs",
    "seam_previews",
    "motion_curve_snapshot_relpath",
    "checkpoint_strip_relpath"
  ],
  "properties": {
    "version": {
      "const": "segment_debug_manifest.v1"
    },
    "job_id": {
      "type": "string",
      "minLength": 1
    },
    "source_final_mp4": {
      "type": "string",
      "pattern": "^sandbox/output/.+/final\\.mp4$"
    },
    "debug_dir": {
      "type": "string",
      "pattern": "^sandbox/output/.+/debug$"
    },
    "inputs": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "segment_stitch_report_relpath",
        "frame_manifest_relpath"
      ],
      "properties": {
        "segment_stitch_report_relpath": {
          "type": "string",
          "pattern": "^sandbox/output/.+/segments/segment_stitch_report\\.v1\\.json$"
        },
        "frame_manifest_relpath": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^(sandbox/output/.+/frames/frame_manifest\\.v1\\.json)?$"
        }
      }
    },
    "seam_previews": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "seam_index",
          "from_segment",
          "to_segment",
          "preview_relpath",
          "start_sec",
          "end_sec"
        ],
        "properties": {
          "seam_index": {
            "type": "integer",
            "minimum": 1
          },
          "from_segment": {
            "type": "string",
            "pattern": "^seg_[0-9]{3}$"
          },
          "to_segment": {
            "type": "string",
            "pattern": "^seg_[0-9]{3}$"
          },
          "preview_relpath": {
            "type": "string",
            "pattern": "^sandbox/output/.+/debug/seams/seam_[0-9]{3}\\.mp4$"
          },
          "start_sec": {
            "type": "number",
            "minimum": 0
          },
          "end_sec": {
            "type": "number",
            "minimum": 0
          }
        }
      }
    },
    "motion_curve_snapshot_relpath": {
      "type": "string",
      "pattern": "^sandbox/output/.+/debug/motion_curve_snapshot\\.v1\\.json$"
    },
    "checkpoint_strip_relpath": {
      "type": [
        "string",
        "null"
      ],
      "pattern": "^(sandbox/output/.+/debug/checkpoint_strip\\.png)?$"
    }
  }
}
