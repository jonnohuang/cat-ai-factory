{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://cat-ai-factory/publish_plan.v1.schema.json",
    "title": "Publish Plan v1",
    "description": "Deterministic contract for publishing content to external platforms.",
    "type": "object",
    "required": [
        "version",
        "job_id",
        "platform_plans"
    ],
    "additionalProperties": false,
    "properties": {
        "version": {
            "const": "publish_plan.v1",
            "description": "Schema version."
        },
        "job_id": {
            "type": "string",
            "description": "Job ID this plan belongs to."
        },
        "platform_plans": {
            "type": "object",
            "description": "Map of platform-specific publication plans.",
            "additionalProperties": false,
            "properties": {
                "youtube": {
                    "$ref": "#/definitions/PlatformPlan"
                },
                "instagram": {
                    "$ref": "#/definitions/PlatformPlan"
                },
                "tiktok": {
                    "$ref": "#/definitions/PlatformPlan"
                },
                "x": {
                    "$ref": "#/definitions/PlatformPlan"
                }
            }
        }
    },
    "definitions": {
        "PlatformPlan": {
            "type": "object",
            "required": [
                "clips"
            ],
            "additionalProperties": false,
            "properties": {
                "clips": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/ClipPlan"
                    },
                    "minItems": 1
                },
                "title": {
                    "$ref": "#/definitions/LanguageMap"
                },
                "description": {
                    "$ref": "#/definitions/LanguageMap"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "publish_time": {
                    "type": "string",
                    "description": "ISO 8601 timestamp for scheduled publishing."
                }
            }
        },
        "ClipPlan": {
            "type": "object",
            "required": [
                "video_path",
                "audio_plan",
                "audio_notes"
            ],
            "additionalProperties": false,
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the clip within this plan."
                },
                "video_path": {
                    "type": "string",
                    "pattern": "^/sandbox/output/.*",
                    "description": "Absolute path to the video file."
                },
                "audio_plan": {
                    "type": "object",
                    "description": "Structured audio strategy.",
                    "required": [
                        "strategy"
                    ],
                    "properties": {
                        "strategy": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": true
                },
                "audio_notes": {
                    "type": "string",
                    "description": "Human-readable notes for audio implementation."
                },
                "audio_assets": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^/sandbox/(assets|dist_artifacts)/.*"
                    },
                    "description": "List of optional audio assets."
                },
                "caption": {
                    "$ref": "#/definitions/LanguageMap"
                }
            }
        },
        "LanguageMap": {
            "type": "object",
            "description": "Localized text content.",
            "additionalProperties": false,
            "properties": {
                "en": {
                    "type": "string"
                },
                "zh-Hans": {
                    "type": "string"
                }
            },
            "minProperties": 1
        }
    }
}