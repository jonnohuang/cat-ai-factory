{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://cat-ai-factory.repo/shared/series_bible.v1.schema.json",
    "title": "Cat AI Factory Series Bible v1",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "project",
        "schema",
        "version",
        "generated_at",
        "tone",
        "boundaries",
        "canon",
        "running_gags",
        "settings"
    ],
    "properties": {
        "project": {
            "const": "Cat AI Factory"
        },
        "schema": {
            "const": "series_bible.v1"
        },
        "version": {
            "type": "string",
            "minLength": 1
        },
        "generated_at": {
            "type": "string",
            "format": "date-time"
        },
        "tone": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "logline",
                "voice_style"
            ],
            "properties": {
                "logline": {
                    "$ref": "#/definitions/language_map"
                },
                "voice_style": {
                    "$ref": "#/definitions/language_map"
                }
            }
        },
        "boundaries": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "forbidden_topics",
                "allowed_humor"
            ],
            "properties": {
                "forbidden_topics": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "allowed_humor": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                }
            }
        },
        "canon": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "core_rules"
            ],
            "properties": {
                "core_rules": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "default_cast": {
                    "type": "array",
                    "uniqueItems": true,
                    "items": {
                        "$ref": "#/definitions/kebab_id"
                    }
                }
            }
        },
        "running_gags": {
            "type": "array",
            "minItems": 1,
            "items": {
                "$ref": "#/definitions/running_gag"
            }
        },
        "settings": {
            "type": "array",
            "minItems": 1,
            "items": {
                "$ref": "#/definitions/setting"
            }
        }
    },
    "definitions": {
        "kebab_id": {
            "type": "string",
            "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
        },
        "language_map": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "en",
                "zh-Hans"
            ],
            "properties": {
                "en": {
                    "type": "string",
                    "minLength": 1
                },
                "zh-Hans": {
                    "type": "string",
                    "minLength": 1
                }
            }
        },
        "running_gag": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "gag_id",
                "setup",
                "payoff"
            ],
            "properties": {
                "gag_id": {
                    "$ref": "#/definitions/kebab_id"
                },
                "setup": {
                    "$ref": "#/definitions/language_map"
                },
                "payoff": {
                    "$ref": "#/definitions/language_map"
                },
                "usage_notes": {
                    "type": "string",
                    "minLength": 1
                }
            }
        },
        "setting": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "setting_id",
                "description"
            ],
            "properties": {
                "setting_id": {
                    "$ref": "#/definitions/kebab_id"
                },
                "description": {
                    "$ref": "#/definitions/language_map"
                },
                "props": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                }
            }
        }
    }
}